## Prompts for 2025-11-14

1. **Prompt:** from client\src\components\ViewModel\useMapViewModel.js there are utility functions starting from line 38. shift them to client\src\utils folder with proper files. and then call in useMapViewModel.

2. **Prompt:** Update `useMapViewModel` hook in React for Mapbox map to support multiple modes: dashboard, wizard (farm drawing + farm splitting), and wizard-fields (field drawing/selection).
    1. **Map Initialization**
    - Currently, map initializes only for `dashboard` mode.
    - Change the map initialization useEffect to include `"dashboard"`, `"wizard"`, and `"wizard-fields"` modes:
        * Set map center using `calculateMapCenter(farmsGeoJSON)` (fallback `[0,0]` if null).
        * Add `NavigationControl`.
        * On map load, set `mapLoaded = true`.
        * If mode is `"wizard"` or `"wizard-fields"`, call a new function `initializeDrawTool(mode)`.

    2. **Add Draw Tool**
    - Create a `drawRef` using `useRef(null)`.
    - Implement `initializeDrawTool(mode)` function:
        * Attach MapboxDraw to the map.
        * Enable polygon draw and trash controls.
        * Set `defaultMode: "draw_polygon"`.
        * Add draw events: `draw.create`, `draw.update`, `draw.delete` → call `updateDrawnData(mode)`.

    - Implement `updateDrawnData(mode)` function using `useCallback`:
        * Get all drawn features via `drawRef.current.getAll()`.
        * Update `drawnData` state.
        * Calculate area of drawn polygons using Turf.js (`turf.area()`) and update `area` state.
        * If mode is `"wizard"` (farm drawing):
        - Support **splitting farm polygon into multiple parts** (for later field assignment).
        * If mode is `"wizard-fields"`:
        - Track which farm the field belongs to.
        - Allow drawing/editing fields inside existing farm polygons.
        * If no features, set `area = null`.

    3. **Handle Wizard → Field Selection Transition**
    - After user finishes drawing farms:
        * Hide farm draw tools (`map.current.removeControl(drawRef.current)`).
        * Switch to `"wizard-fields"` mode:
        - Enable field drawing inside selected farm polygon(s).
        - Keep ability to edit existing field boundaries.
        * Update click handlers for selecting fields inside drawn farm polygons.

    4. **Update Hook Return Values**
    - Add `drawRef` to returned values so components can access it:
        * `return { mapContainer, handleRecenter, area, drawnData, drawRef }`.

    5. **Optional Enhancements**
    - Pin a draggable marker at farm’s central location during farm wizard mode.
    - Import/export drawn boundaries as GeoJSON or CSV.
    - Keep existing dashboard logic intact.
    - Keep hover popup and field selection click logic unchanged.

    6. **Final Goal**
    - `useMapViewModel` should now handle:
        * `"dashboard"` mode → show farms/fields with hover as it is currently doing no changes in it.
        * `"wizard"` mode → draw/edit/delete farm polygons, with farm splitting option.
        * `"wizard-fields"` mode → draw/edit fields inside drawn farm boundaries.
    - `MapWizardFarm` component should:
        * Use `drawnData` and `area` from the hook.
        * Call `onDrawComplete` callback whenever polygons are drawn, edited, or split.


3. **Prompt:** Change only the doc\Map Implementation.md and wait for my approval before implementing :
    - Instead of the wizard-field view, just keep the wizard view and on pressing next hide the farm layer and only show fields layer because the farm was broken down into fields.
    - Also implement the change to allow user to enter no of fields to break down farm into and on pressing next the farms layer hide and only fields show as we did in the dashboard mode of map.
    - Keep the dashboard view as it is don't change anything in it.
    - now we have only 2 modes, the dashboard and the wizard, inside the wizard on farm selection after next we will just hide the farm layer and preview the field layer and allow to edit field there.

4. **Prompt:** in client\src\components\View\MapWizard.jsx I want to show the map, and allow the user to draw farm:
        - After drawing the boundary ask number of fields.
        - Press next button and hide farm layer and only show those divided fields with option to edit like:
         - edit boundaries.
         - splitting a field.
         - deleting a field.
         - merge 2 fields.
        - Read client\src\components\ViewModel\useMapViewModel.js if any additions are needed, keep rest of the funcionality same don't mess with that.
5. **Prompt:** Just rewrite this client\src\components\ViewModel\useMapViewModel.js,

    so that it can do the following in the wizard mode:
    - Allow drawing(already done).
    - Show proper map right now just black area is shown.
    - Add a function which will be taking some number from view layer as number of fields and upon pressing next from view layer, change the current outline in those equivalent parts.
    - update the view layer client\src\components\View\MapWizard.jsx accordingly.

6. **Prompt:** okay so in client\src\components\View\MapWizard.jsx.
 i used the exact same view layer like from client\src\components\View\Map.jsx
 - now it previews and loads map correctly,